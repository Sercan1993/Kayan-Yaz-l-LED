/*****************************************************
       16 x 128 LED dot matrix screen C program
******************************************************
Statement:
     The learning process for everyone , do not use for commercial purposes. Respect copyrights.

Written by: Deng Chun salary
Time: January 20, 2006 evening
E-mail : love2151@xinhuanet.com
*******************************************************

// 595 even level output data , 138 line driver . P0_1 speed /* dot matrix display Chinese characters in the serial data output speed,
// P2 port output line scanning signal , P2_7 latch output signal 595 . */


# include <AT89x51.H>
# define uchar unsigned char
# define uint unsigned int
uchar yid, h; // YID for mobile counters , H is the line segment counter.
uint zimuo; // font counter
uchar code hanzi []; // Chinese Fonts
uchar nmk [18]; // buffer
void in_data (void); // adjustment data
void rxd_data (void); // send data
void sbuf_out (); // 16 segment sweep
unsigned code sw [16] = {0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x08,0x09,0x0a,0x0b,0x0c,0x0d,0x0e,0x0f}; /* 16 -line segment code */

// {0x60, 0x62, 0x64, 0x66, 0x68, 0x6a, 0x6c, 0x6e,
                   // 0x70, 0x72, 0x74, 0x76, 0x78, 0x7a, 0x7c, 0x7e}; / * 16 -line segment code * /

/********************************************/
void main (void)
{
 uchar i, d = 1;
 yid = 16;
 zimuo = 128;
 while (1)
  {
while (yid>0) // data shift .
{
for (i=0;i<d;i++) // moving speed
{
sbuf_out ();
         }
yid --; // move one step
}
   yid = 16 ;
   zimuo = zimuo -16; // backward one word
   if (zimuo<=0) // Total minus seven words.
   zimuo = 128;
  }

 
}
/********************************/
void sbuf_out ()
{
for (h=0;h<16;h++) // 16 line scan
{
in_data (); // adjustment data
rxd_data (); // serial port to send data
         P1 = 0x7f; // close the show .
         P1_7 = 1; // latch is high, the latch signal 595
P1 = sw [h]; // send Segment



}
}

/******************************************************/
void in_data (void)
{
 char s;
for (s=8;s>=0;s--) // h for the first choice back byte counter , zimuoo first word counter for backward
{
nmk [2 * s+1] = hanzi [zimuo +16 * s +2 * h]; // The first byte of the first placed BUFF0 matrix , the matrix and the second byte Add BUFF2 in
nmk [2 * s] = hanzi [zimuo +1 +16 * s +2 * h]; // the second byte of the first matrix into BUFF1 , the second matrix of the second byte Add BUFF3 in
}
}

/*******************************************************/
void rxd_data (void) // Serial Transmit Data
{
  char s;
  uchar nc, vb, vc;
  
  
  if (yid <8)
    nc = 0;
  else
    nc = 1;


  for (s=0+nc;s<16+nc; s++) // send 8 bytes of data
{
if (yid <8)
     vb = yid;
      else
    vb = yid-8;
 
   vc = (nmk [s] >> vb) | (nmk [s +1] << (8-vb)); 
	// h1 and h2 left tempyid bit right shift 8-tempyid phase or , after removing the shift data.
    // temp = 255-temp;


SBUF = vc ;// BUFF bytes in the descending phase shifted or send output.
 // wait for transmit interrupt
}
}
/*******************************************************/
uchar code hanzi [] =
{
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

// ================================================ =============================


/// T & I width x height = 16x16 - * /
0x18,0x7e, 0x18,0x7e, 0x18, 0x18, 0x18, 0x18,0x18,  0x18, 0x18, 0x18, 0x18, 0x18,0x18, 0x18, 


/// S & H width x height = 16x16 - * /
0x66,0x7e, 0x66, 0x7e, 0x66,0x06, 0x7e, 0x7e,  0x7e,0x7e, 0x66,  0x60, 0x66, 0x7e,  0x66,0x7e, 


/// U & R width x height = 16x16 - * /
0x7e,0x66, 0x7e, 0x66, 0x66, 0x66, 0x66,0x66, 0x7e, 0x66,  0x1e,0x66, 0x36, 0x7e,  0x66,0x7e, 


/// I & SPACE width x height = 16x16 - * /
0x00,0x18, 0x00,0x18, 0x00,0x18, 0x00,0x18,0x00,0x18, 0x00,0x18, 0x00,0x18, 0x00,0x18, 


/// U & C width x height = 16x16 - * /
 0x7e,0x66,0x7e, 0x66,  0x06,0x66, 0x06,0x66, 0x06,0x66, 0x06, 0x66,  0x7e,0x7e,  0x7e, 0x7e,


/// H & A width x height = 16x16 - * /
 0x7e,0x66, 0x7e, 0x66, 0x66, 0x66,0x66,0x7e, 0x7e, 0x7e,  0x66, 0x66, 0x66, 0x66,  0x66, 0x66,




// ================================================ ============================
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

} ;